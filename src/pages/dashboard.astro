---
import Layout from "../layouts/Layout.astro"
import App from "../components/app/App"

import { Auth, SignOut } from "auth-astro/components"
import { getSession } from "auth-astro/server"

let session = await getSession(Astro.request)
if (!session) return Astro.redirect("/signup")
---

<Layout title="ArcAide - Dashboard" description="Metadescription" noNav={true}>
  <Auth>
    <button id="logout"
      >Sign Out
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
      >
        <path
          fill="currentColor"
          d="M19 3H5c-1.11 0-2 .89-2 2v4h2V5h14v14H5v-4H3v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m-8.92 12.58L11.5 17l5-5l-5-5l-1.42 1.41L12.67 11H3v2h9.67l-2.59 2.58Z"
        ></path>
      </svg></button
    >
    <App client:load userId={session} />
  </Auth>
</Layout>

<script>
  const { signOut } = await import("auth-astro/client")
  document.querySelector("#logout").onclick = () => signOut()
</script>

<style>
  button#logout {
    margin-left: 1.5rem;
    font-size: var(--fs-400);
    color: white;
    text-decoration: none;
    position: fixed;
    display: flex;
    align-items: center;
    cursor: pointer;
    gap: 10px;
    background: none;
    border: none;
    bottom: 2rem;
    padding: 0;
    z-index: 2;
  }
</style>
